<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>웹 프론트엔드 개발 7주차 수업</title>
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="font-awesome/css/font-awesome.css" rel="stylesheet">
    <!-- Sweet Alert -->
    <link href="css/plugins/sweetalert/sweetalert.css" rel="stylesheet">
    <!-- Datatable -->
    <link href="css/plugins/dataTables/dataTables.bootstrap.min.css" rel="stylesheet">
    <link href="css/plugins/dataTables/responsive.bootstrap.min.css" rel="stylesheet">
</head>

<body>
    <!-- Static navbar -->
    <nav class="navbar navbar-default navbar-static-top">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="#">Project name</a>
            </div>
            <div id="navbar" class="navbar-collapse collapse">
                <ul class="nav navbar-nav">
                    <li><a href="#">Home</a></li>
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">사용자관리 <span class="caret"></span></a>
                        <ul class="dropdown-menu">
                            <li class="active"><a href="013_user_list.html">사용자리스트</a></li>
                            <li><a href="011_user_create.html">사용자생성</a></li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Plugins <span class="caret"></span></a>
                        <ul class="dropdown-menu">
                            <li><a href="001_icheck.html">iCheck</a></li>
                            <li><a href="002_sweetalert.html">Sweet Alert</a></li>
                            <li><a href="003_datepicker.html">Datepicker</a></li>
                            <li><a href="004_datatable.html">Datatable</a></li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Dropdown <span class="caret"></span></a>
                        <ul class="dropdown-menu">
                            <li><a href="#">Action</a></li>
                            <li><a href="#">Another action</a></li>
                            <li><a href="#">Something else here</a></li>
                            <li role="separator" class="divider"></li>
                            <li class="dropdown-header">Nav header</li>
                            <li><a href="#">Separated link</a></li>
                            <li><a href="#">One more separated link</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
            <!--/.nav-collapse -->
        </div>
    </nav>
    <div class="container">
        <div class="page-header">
            <h3>사용자 조회</h3>
        </div>
        <div class="row">
            <div class="form-inline">
                <div class="col-md-3">
                    <div class="form-group">
                        <label for="userid">아이디</label>
                        <input type="text" class="form-control" id="userid">
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="form-group">
                        <label for="username">이름</label>
                        <input type="text" class="form-control" id="username">
                    </div>
                </div>
                <div class="col-md-2">
                    <div class="form-group">
                        <label for="username">메일수신동의</label>
                        <select class="form-control" id="sel_email_yn">
                            <option value="">전체</option>
                            <option value="Y">동의</option>
                            <option value="N">거부</option>
                        </select>
                    </div>
                </div>
                <div class="col-md-2">
                    <div class="form-group">
                        <label for="username">문자수신동의</label>
                        <select class="form-control" id="sel_msg_yn">
                            <option value="">전체</option>
                            <option value="Y">동의</option>
                            <option value="N">거부</option>
                        </select>
                    </div>
                </div>
                <div class="col-md-2" style="text-align: right;">
                    <button type="button" class="btn btn-primary" id="btn_search"><i class="fa fa-search"></i> 조회</button>
                    <button type="button" class="btn btn-danger" id="btn_create"><i class="fa fa-user"></i> 생성</button>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-12">
                <table id="result_table" class="table table-striped table-bordered table-hover dt-responsive nowrap" cellspacing="0" width="100%">
                    <thead>
                        <tr>
                            <th data-priority="1" class="text-center">아이디</th>
                            <th data-priority="2" class="text-center">이름</th>
                            <th data-priority="3" class="text-center">이메일</th>
                            <th data-priority="4" class="text-center">핸드폰</th>
                            <th data-priority="5" class="text-center">성별</th>
                            <th data-priority="6" class="text-center">생년월일</th>
                            <th data-priority="7" class="text-center">메일수신동의</th>
                            <th data-priority="8" class="text-center">문자수신동의</th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <!-- /container -->
    <script src="js/jquery-2.1.1.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <!-- Sweet alert -->
    <script src="js/plugins/sweetalert/sweetalert.min.js"></script>
    <!-- data tables for bootstrap design-->
    <script src="js/plugins/dataTables/datatables.min.js"></script>
    <script src="js/plugins/dataTables/dataTables.bootstrap.min.js"></script>
    <script src="js/plugins/dataTables/dataTables.responsive.min.js"></script>
    <script src="js/plugins/dataTables/responsive.bootstrap.min.js"></script>
    <script src="js/util.js"></script>
    <script>
    var table = null;

    function initTable() {
        table = $('#result_table').DataTable({
            "retrieve": true,
            "data": [],
            "columns": [{
                "data": "userId",
                "className": "text-center"
            }, {
                "data": "name"
            }, {
                "data": "email"
            }, {
                "data": "phone"
            }, {
                "data": "gender",
                "className": "text-center"
            }, {
                "data": "birth_date",
                "className": "text-center"
            }, {
                "data": "email_yn",
                "className": "text-center"
            }, {
                "data": "msg_yn",
                "className": "text-center"
            }],

            "columnDefs": [{
                "targets": [0],
                "data": "userId",
                "render": function(data, type, row, meta) {
                    return '<a href="javascript:moveToDetail(\'' + row["userId"] + '\');" class="text-underline">' + row["userId"] + '</a>'
                }
            }, {
                "targets": [5],
                "data": "birth_date",
                "render": function(data, type, row, meta) {
                    return dateUtil.getFormatValue(data, 'yyyy-MM-dd');
                }
            }, {
                "targets": [6],
                "data": "email_yn",
                "render": function(data, type, row, meta) {
                    if (data) return '동의';
                    else return '거부';
                }
            }, {
                "targets": [7],
                "data": "msg_yn",
                "render": function(data, type, row, meta) {
                    if (data) return '동의';
                    else return '거부';
                }
            }],

            responsive: {
                details: {
                    renderer: function(api, rowIdx, columns) {

                        var data = $.map(columns, function(col, i) {
                            return col.hidden ?
                                '<tr data-dt-row="' + rowIdx + '" data-dt-column="' + i + '">' +
                                '<td style="width:50%;">' + col.title + '</td> ' +
                                '<td style="width:50%;white-space:normal;">' + col.data + '</td>' +
                                '</tr>' :
                                '';
                        }).join('');

                        return data ?
                            $('<div />').append('<h4 style="border-left:5px solid #337ab7;padding-left:3px;">Detail</h4>').append($('<table class="table table-bordered" />').append(data)) :
                            false;
                    }
                }
            },

            order: [1, 'asc'],

            "pageLength": 10,

            "dom": "<'row'<'col-sm-12'tr>>" + "<'row paging-bar'<'col-sm-5'i><'col-sm-7'p>>",

            "initComplete": function(settings, json) {

            }
        });
    }

    function renderTable(data) {
        table.clear();
        table.rows.add(data).draw();
    }

    function doSearch() {
        var userid = $('#userid').val();
        var username = $('#username').val();
        var sel_email_yn = $('#sel_email_yn').val();
        var sel_msg_yn = $('#sel_msg_yn').val();

        var param = "USER_ID=" + userid + "&USER_NAME=" + username + "&EMAIL_YN=" + sel_email_yn + "&MSG_YN=" + sel_msg_yn

        $.getJSON("json/user.model.json", param)
            .done(function(json) {
                renderTable(json['UserList']);

            })
            .fail(function(jqxhr, textStatus, error) {
                var err = textStatus + ", " + error;
                swal('Error', "Request Failed: " + err, 'error');
            });
    }

    function moveToDetail(doc_no, no) {
        document.location.href = '012_user_detail.html';
    }

    $(document).ready(function() {
        initTable();

        $('#btn_search').click(function() {
            doSearch();
        });

        $('#btn_create').click(function() {
            document.location.href = '011_user_create.html';
        });

    });
    </script>
</body>

</html>
